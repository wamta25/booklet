Task-parallel pipeline framework explores pipeline parallelism in applications and is critical in many parallel and heterogeneous areas, such as static timing analysis and data similarity search. However, existing solutions only deal with certain types of applications in which data dependencies exist between preceding data and succeeding data in a forward direction. Some applications, such as video encoding, exhibit data dependencies in both forward and backward directions and cannot be processed with existing solutions. To address the limitation, we introduce a token dependency awareness pipeline framework. Our framework associates each data element with a token as its identifier, supports explicit definitions of forward and backward token dependencies with an expressive programming model, resolves dependencies using simple data structures, and schedules tokens with lightweight atomic counters. We have evaluated the framework on applications that exhibit both forward and backward token dependencies. For example, our framework is 11\% faster than PARSEC's implementation in x.264 video encoding applications.
