The OpenMP 6.0 standard introduces the Free Agents feature, which supports a more dynamic execution model to improve application malleability and resource utilization. With Free Agents, when a thread is idle within a parallel region, it can be dynamically reused to execute tasks from another parallel region. However, implementing this model within production-grade runtimes like LLVM libomp poses performance and complexity challenges due to its departure from conventional threading models. This paper presents our implementation of Free Agents within the LLVM libomp runtime, which significantly reduces the complexity of implementing Free Agents in libomp by leveraging the nOS-V threading and tasking library. Moreover, nOS-V also provides support for Task-Aware (TA) libraries and the co-execution of applications. Our enhanced libomp runtime, ported on top of nOS-V (libompv), also leverages these features. With libompv, OpenMP tasks and threads from any parallel region can safely call TA libraries, and independent processes can be efficiently co-executed to improve resource utilization or mitigate load imbalance issues. Experimental results demonstrate that libompv achieves performance on par with the original libomp runtime while offering increased flexibility and functionality.
